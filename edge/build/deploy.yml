---
- hosts: raspberrypi.local
  become: yes
  vars_files:
    - vault.yml
  tasks:
    - include_role:
        name: mikolak-net.raspi_config
      vars:
        raspi_config_update_packages: no
        raspi_config_locale: en_GB.UTF-8
        raspi_config_timezone: Europe/London
        raspi_config_replace_user:
          name: "{{ ssh_user.name }}"
          path_to_ssh_key: "{{ ssh_user.key }}"
        raspi_config_fail_on_auth_test: no
    - name: Connect to wifi
      include_role:
        name: layereight.wifi
      vars:
        wifi_ssid: "{{ wifi.ssid }}"
        wifi_psk: "{{ wifi.password }}"
    - name: Install tools
      apt:
        name: "{{ packages }}"
      vars:
        packages:
          - fish
    - name: Set fish as the default shell
      user:
        name: "{{ ssh_user.name }}"
        shell: /usr/bin/fish
